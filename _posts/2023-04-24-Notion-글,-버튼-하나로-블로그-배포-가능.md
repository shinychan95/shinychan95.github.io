---
title: Notion 글, 버튼 하나로 블로그 배포 가능?
author: chanyoung_kim
date: 2023-04-24 02:13:42 +0900
categories: [ToyProject, ForFun]
tags: [notion, blog]
---

## 주제를 정한 목적
> 🦖 _흥미롭고 유익하고 관심을 끌만한 주제는 무엇이 있을까?_
- Notion 을 사용하고 있는 우리 _(특히 나…)_
- 그리고 필수 소양인 `개발 블로그`
   - Notion 도 블로그로 만들 수 있지만, SEO(검색엔진 최적화) 관점에서 검색이 잘 안된다.
   - 뭐 다들 운영하면서 광고로 돈 벌고 계시잖아요? 🤷🏻‍♂️
      <details>
      <summary>…</summary>
         아니요… 저는 마음만 몇십 번 먹었지만, 꾸준히 하지 못하고 있습니다… 
      </details>
   - **Notion 에 편하게 글 적고 알아서 블로그에 반영이 된다면?**

### 얻어갈 수 있는 점
- 개념, 지식, 설명
- 하나의 프로젝트 기반 결과물
- `+a` Honey Tips

### **결론적으로 주제는! Notion 글, 버튼 하나로 블로그 배포 가능?**
> **“가능하지 않다”** 라는 결론으로 귀결될 가능성이 크다.

하지만, 이를 조사하면서 Notion 서비스가 어떻게 `offline` 에서 사용 가능한지 공부해보고 싶다.

**특히, 어떻게 데이터를 저장하고 관리하는지 공부해보고 싶다. (압축을 하는지, 형식은 어떤 방식인지)**

_만약 이것이 가능하다면, 꽤나 네이버 내에서 유용한 공유가 되지 않을까 싶다…!_




---



## lsof 명령어를 통해 노션 캐시 데이터를 찾을 수 없을까?
참고 자료 : [https://www.lesstif.com/system-admin/lsof-20776078.html](https://www.lesstif.com/system-admin/lsof-20776078.html)
> 🦖 `lsof` 명령어를 활용하여 Notion과 관련되어 열려 있는 파일 목록들을 모두 살펴볼 수 있다.

```Shell
user ➜  ~ lsof -c Notion
COMMAND     PID USER   FD      TYPE             DEVICE  SIZE/OFF                NODE NAME
Notion      650 user  cwd       DIR               1,18       640                   2 /
Notion      650 user  txt       REG               1,18    238944            54595517 /Applications/Notion.app/Contents/MacOS/Notion
Notion      650 user  txt       REG               1,18     51456            59745768 /Library/Preferences/Logging/.plist-cache.GaIilKan
Notion      650 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
Notion      650 user  txt       REG               1,18    108608            54609124 /Applications/Notion.app/Contents/Frameworks/Mantle.framework/Versions/A/Mantle
...
Notion      794 user  cwd       DIR               1,18       640                   2 /
Notion      794 user  txt       REG               1,18    122784            54609133 /Applications/Notion.app/Contents/Frameworks/Notion Helper (GPU).app/Contents/MacOS/Notion Helper (GPU)
Notion      794 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
Notion      794 user  txt       REG               1,18    108608            54609124 /Applications/Notion.app/Contents/Frameworks/Mantle.framework/Versions/A/Mantle
Notion      794 user  txt       REG               1,18    390656            54609095 /Applications/Notion.app/Contents/Frameworks/ReactiveObjC.framework/Versions/A/ReactiveObjC
...
Notion      795 user  cwd       DIR               1,18       640                   2 /
Notion      795 user  txt       REG               1,18    122784            54609102 /Applications/Notion.app/Contents/Frameworks/Notion Helper.app/Contents/MacOS/Notion Helper
Notion      795 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
Notion      795 user  txt       REG               1,18    108608            54609124 /Applications/Notion.app/Contents/Frameworks/Mantle.framework/Versions/A/Mantle
Notion      795 user  txt       REG               1,18     28672              617445 /Users/user/Library/Application Support/Notion/Partitions/notion/Cookies
...
Notion      959 user  cwd       DIR               1,18       640                   2 /
Notion      959 user  txt       REG               1,18    122784            54609102 /Applications/Notion.app/Contents/Frameworks/Notion Helper.app/Contents/MacOS/Notion Helper
Notion      959 user  txt       REG               1,18     51456            59745768 /Library/Preferences/Logging/.plist-cache.GaIilKan
Notion      959 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
Notion      959 user  txt       REG               1,18    108608            54609124 /Applications/Notion.app/Contents/Frameworks/Mantle.framework/Versions/A/Mantle
...
Notion    62734 user  cwd       DIR               1,18       640                   2 /
Notion    62734 user  txt       REG               1,18    122784            54609142 /Applications/Notion.app/Contents/Frameworks/Notion Helper (Renderer).app/Contents/MacOS/Notion Helper (Renderer)
Notion    62734 user  txt       REG               1,18     51456            59745768 /Library/Preferences/Logging/.plist-cache.GaIilKan
Notion    62734 user  txt       REG               1,18     94156            54608944 /Applications/Notion.app/Contents/Frameworks/Electron Framework.framework/Versions/A/Resources/chrome_100_percent.pak
Notion    62734 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
...
Notion    62735 user  cwd       DIR               1,18       640                   2 /
Notion    62735 user  txt       REG               1,18    122784            54609142 /Applications/Notion.app/Contents/Frameworks/Notion Helper (Renderer).app/Contents/MacOS/Notion Helper (Renderer)
Notion    62735 user  txt       REG               1,18     51456            59745768 /Library/Preferences/Logging/.plist-cache.GaIilKan
Notion    62735 user  txt       REG               1,18     94156            54608944 /Applications/Notion.app/Contents/Frameworks/Electron Framework.framework/Versions/A/Resources/chrome_100_percent.pak
Notion    62735 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
...
Notion    62736 user  cwd       DIR               1,18       640                   2 /
Notion    62736 user  txt       REG               1,18    122784            54609142 /Applications/Notion.app/Contents/Frameworks/Notion Helper (Renderer).app/Contents/MacOS/Notion Helper (Renderer)
Notion    62736 user  txt       REG               1,18     51456            59745768 /Library/Preferences/Logging/.plist-cache.GaIilKan
Notion    62736 user  txt       REG               1,18     94156            54608944 /Applications/Notion.app/Contents/Frameworks/Electron Framework.framework/Versions/A/Resources/chrome_100_percent.pak
Notion    62736 user  txt       REG               1,18    147520            54609114 /Applications/Notion.app/Contents/Frameworks/Squirrel.framework/Versions/A/Squirrel
Notion    62736 user  txt       REG               1,18    108608            54609124 /Applications/Notion.app/Contents/Frameworks/Mantle.framework/Versions/A/Mantle
...
```
- 각 프로세스 별로 파일이 참 많이도 떠 있구나.
- 이들 중 높은 확률로 메인 프로그램에 해당하는 `650` 프로세스가 연 파일들을 살펴보았다.
- 하지만, 왠만한 파일을 까봐도 역시나 깨져서 보일 뿐이다.
- **결론적으로 찾은 파일 혹은 키워드**
   ```Shell
   Notion      650 user  txt       REG               1,18      8192              617448 /Users/user/Library/Application Support/Notion/Partitions/notion/GPUCache/data_0
   Notion      650 user  txt       REG               1,18     28672              617561 /Users/user/Library/Application Support/Notion/Partitions/notion/databases/Databases.db
   Notion      650 user   75r      REG               1,18   2195268            60037157 /Users/user/Library/Application Support/Notion/Partitions/notion/IndexedDB/notion_www.notion.so_0.indexeddb.leveldb/037217.ldb
   Notion      650 user   79u      REG               1,18     83072            59749851 /Users/user/Library/Saved Application State/notion.id.savedState/data.data
   ```
   



---




## 인터넷 망령 모드 시작
### Notion 의 offline 모드에 대해 검색
~~[https://notionzen.com/notion-offline/](https://notionzen.com/notion-offline/)~~
- 기존에 offline으로도 Notion 사용을 했었고, 한번 봤던 페이지들은 로딩없이 보이길래, 어딘가에 다 저장하고 있는 줄 알았다.
- web-based application
- offline 상황에서 다시 인터넷이 연결되면 약 20% 가량 데이터를 잃게 된다. ~~(완전 초기 지금은 아니다)~~

### Notion 공식 블로그 내 데이터 모델 발견
~~[https://www.notion.so/blog/data-model-behind-notion](https://www.notion.so/blog/data-model-behind-notion)~~
- 노션 내 정보는 어떤 제약이나 가두리가 존재하지 않는다.
- 노션에서 보는 모든 것을 block이다. (텍스트, 이미지, 리스트, 데이터베이스 내 row, 심지어 페이지 자체도)
- like LEGO 🟥🟨⬜️⬛️
- 물론 block들이 정보화되기 위해서는 엔지니어링 팀이 미쳐날 뛸 노릇이지만, atomic 하고 그래프스러운 데이터 모델을을 원했다.
- **아래 자세하게 정리해보자.**
   - ‣ 





---



## 인터넷 망령 모드 이어서
### indexdDB 에 코드 레벨로 접근할 수 없을까?
~~[https://web.dev/indexeddb/](https://web.dev/indexeddb/)~~
- ⭐️ **조력자의 등장** ⭐️ → ‣ 
   - 하지만, notion 에서는 SQLite 로 옮긴 상태이다. ([****Notion's page load and navigation times just got faster****](https://www.notion.so/ko-kr/blog/faster-page-load-navigation)****)****
      - SQLite 이전에는 클라이언트 측 저장소로 IndexedDB에 의존. 하지만 저장소 할당량, 여러 버그 및 특히 Windows 기기에서의 성능 문제로 인해 IndexedDB 를 사용하지 않게 되었다.



~~[https://www.npmjs.com/package/notion-to-md](https://www.npmjs.com/package/notion-to-md)~~
- Local RecordCache 로부터 데이터를 가져와서 md 로 만드는 것이 아닌, Notion 서버로 요청을 보내서 가져오는 것으로 보인다.
- 하지만, 결론적으로 RecordCache 로부터 데이터를 가져오고 이를 md 로 만드는 것이 실질적으로 어렵다면, 이 방법을 택해보자.
- [x] web-based application 이니 인터넷과 통신하는 과정에서 서버가 존재하고, 혹시 API 기능이 존재하려나?
   - Local 에 따로 API 서버는 존재하지 않고, Notion API 를 통해서, 왠만한 조회 및 연동 기능은 존재한다.
   - [https://developers.notion.com/docs/getting-started](https://developers.notion.com/docs/getting-started)
   - 결론적으로 Notion API 를 위 오픈소스처럼 이용하기는 합니다. **하지만 다릅니다.**


⭐️ **조력자의 등장** ⭐️ → ‣ 




---



## Notion 데이터 모델 분석
### **Block basics**
![](/assets/pages/1eafdee6-189c-46fe-a0fe-5bff83f07309/188c99c2-d7a1-42f3-922f-76351b5f1ab4.png)
- `ID`
   - 페이지 block의 경우, URL 마지막 부분
   - randomly-generated UUIDs (UUID v4) 
      - ex) 95473e9f-a2ab-4f0c-8115-21810a961f4f
      - _성능 이슈는 없을까? →_ ‣
- `Properties`
   - 가장 중점이 되는 데이터인 **title**
- `Type`
   - header (#, ##, ###), text, code, divider, bulleted_list, numbered_list, toggle, …
   - _제 Notion 데이터 기준 31가지 종류 존재_
- `Content`
   - an array (or ordered set) of block IDs representing the content inside this block
- `Parent`
   - the block ID of the block’s parent

### How blocks fit together
- 서로 다른 타입 간 `Turn into` 가능하다.
   - `Type` 과 `Property` 간 커플링이 존재하지 않아서 변환 및 렌더링에 문제없다.
   - ex) ‘to_do’ → ‘text’,  
      - property 내 checked 데이터는 변함이 없다.
- `Content` 로 인해 render tree 를 이룰 수 있다.
- 권한 또한 상속된다.

### Life of a block
- 새로운 block 을 생성하거나 업데이트 하는 경우,
   - 해당 transaction 작업이 `local state` 에 반영
   - 네이티브 앱에서는 SQLite 또는 ⭐️IndexedDB⭐️ 위에 LRU 캐시인 RecordCache를 사용하여 접근한 모든 레코드를 로컬에 저장합니다.
- 그리고 나서  transaction 은 TransactionQueue 에 저장된다. 
   - 최종적으로 Notion 서버에 동기화된다.
- 실시간 업데이트의 경우, MessageStore 로의 웹 소켓 연결을 사용한다. 
   - 즉, 같은 페이지를 보고 있는 경우, Producer, Subscriber 구조로 연결되어 모든 block 들에 대한 subscriber 가 된다.
   - 변경 사항은 먼저 saveTransactions process 를 거치고 난 뒤, 해당 응답을 통해 MessageStore 에 새로운 recorded version 이 확인되면, 연결된 소켓들에게 변경 사항들을 전달한다.
   - 변경 사항을 받은 클라이언트들은 local cache 와 비교하여 version 을 확인한다. 
   - 그리고 나면, Notion 서버로 **syncRecordValues 요청을 보내게 되고, outdated 인 경우, 새로운 Record 를 응답받아 local cache 에 업데이트 및 re-render 한다.**
- block 읽기 과정은,
   - 링크를 통해 페이지를 열게 되면, 먼저 local cache 내용을 확인한다.
   - 이후 Notion API 를 통해서 version 을 비교하여, outdated 인 경우 re-rendering.
   




---




## 드디어 local cache 데이터, 눈 앞에 오다
![](/assets/pages/1eafdee6-189c-46fe-a0fe-5bff83f07309/2456a53a-1772-450c-ba2c-d911c909f1d7.png)
![](/assets/pages/1eafdee6-189c-46fe-a0fe-5bff83f07309/61efae01-695d-4861-bc0d-0f3ce58729e0.png)
**SQLite DB Location :  /Users/user/Library/Application Support/Notion/notion.db **
- ⭐️ **조력자의 도움** ⭐️




> 🦖 **자. 여기까지 왔는데, 과연 버튼 하나로 블로그 배포가 성공하였을까요?**





---





## ⭐️ 조력자 ⭐️ GPT-4 홍보를 시작합니다.
> 🦖 **대부분의  막히는 부분에 대한 해결도 기능에 대한 코드 작성도 모두 ChatGPT 가 수행하였습니다.**

### UUID v4
![](/assets/pages/1eafdee6-189c-46fe-a0fe-5bff83f07309/8f46359f-b1df-4dfd-b6cb-d84ba8ef6b7b.png)
[https://devs0n.tistory.com/39](https://devs0n.tistory.com/39)
- 물론 위 블로그 글을 확인하니, sequential 하게 id 를 생성하여 insert 비용을 낮출 수 있다고 한다.


### IndexedDB → SQLite
![](/assets/pages/1eafdee6-189c-46fe-a0fe-5bff83f07309/c95186b5-091f-4f08-adef-ea78dc8a64cc.png)


### SQLite Browser 및 코드 레벨 접근
![](/assets/pages/1eafdee6-189c-46fe-a0fe-5bff83f07309/f2d622a4-5997-4104-992f-6094add79270.png)

